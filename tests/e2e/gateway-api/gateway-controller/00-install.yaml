apiVersion: v1
kind: Namespace
metadata:
  name: helicone-infrastructure
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: test-values
  namespace: helicone-infrastructure
data:
  values.yaml: |
    global:
      provider:
        cloud: aws
      aws:
        region: us-east-1

    gateway:
      enabled: true
      className: "aws-gateway-controller-nlb"
      annotations:
        service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
        service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"
      tls:
        mode: "Passthrough"
      allowedRoutes:
        namespaces:
          from: All

    awsGatewayController:
      enabled: true
      version: "v1.0.0"
      region: "us-east-1"
      vpcId: "vpc-test123"
      accountId: "123456789012"
      serviceAccount:
        create: true
        name: aws-gateway-controller
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: 500m
          memory: 512Mi
---
apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
  - command: helm upgrade --install helicone-infrastructure ../../../../charts/helicone-infrastructure -n helicone-infrastructure --values /tmp/test-values.yaml --wait
    namespaced: false
